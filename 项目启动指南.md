# APITable é¡¹ç›®å¯åŠ¨æŒ‡å—

## é¡¹ç›®æ¦‚è¿°

APITable æ˜¯ä¸€ä¸ªæ”¯æŒå®æ—¶åä½œçš„å¯è§†åŒ–æ•°æ®åº“äº§å“ï¼Œå…·æœ‰ä»¥ä¸‹æ ¸å¿ƒç‰¹å¾ï¼š
- **å®æ—¶åä½œ** - æ”¯æŒå¤šç”¨æˆ·åŒæ—¶ç¼–è¾‘
- **å¯è§†åŒ–** - æä¾›ç›´è§‚çš„æ•°æ®æ“ä½œç•Œé¢
- **æ•°æ®åº“** - å¼ºå¤§çš„æ•°æ®å­˜å‚¨å’ŒæŸ¥è¯¢èƒ½åŠ›

## ç¯å¢ƒè¦æ±‚

### å¿…éœ€è½¯ä»¶åŠç‰ˆæœ¬

| è½¯ä»¶ | ç‰ˆæœ¬è¦æ±‚ | è¯´æ˜ |
|------|----------|------|
| Git | 2.49.0+ | ç‰ˆæœ¬æ§åˆ¶ |
| Node.js | 16.15.0 | ä½¿ç”¨nvmå®‰è£…æ¨è |
| pnpm | 8.15.9 | åŒ…ç®¡ç†å™¨ |
| Java | OpenJDK 17.0.15+ | åç«¯æœåŠ¡ |
| Python | 3.13+ | æ„å»ºå·¥å…· |
| Docker Desktop | 4.40.0+ | å®¹å™¨åŒ–éƒ¨ç½² |

> âš ï¸ **é‡è¦**: Node.jså’Œpnpmç‰ˆæœ¬å¿…é¡»ä¸¥æ ¼æŒ‰ç…§è¦æ±‚ï¼Œå¦åˆ™`pnpm install`ä¼šæŠ¥é”™

### ç¯å¢ƒæ£€æŸ¥å‘½ä»¤

```bash
# æ£€æŸ¥å„è½¯ä»¶ç‰ˆæœ¬
node --version    # åº”æ˜¾ç¤º v16.15.0
pnpm --version    # åº”æ˜¾ç¤º 8.15.9
java --version    # åº”æ˜¾ç¤º OpenJDK 17.x
python3 --version # åº”æ˜¾ç¤º Python 3.13.x
docker --version  # åº”æ˜¾ç¤º Docker 24.x+
```

## è¯¦ç»†å¯åŠ¨æ­¥éª¤

### æ­¥éª¤1: ç¯å¢ƒæ£€æŸ¥

é¦–å…ˆæ£€æŸ¥æ‰€æœ‰å¿…éœ€çš„ç¯å¢ƒä¾èµ–æ˜¯å¦å·²æ­£ç¡®å®‰è£…ï¼š

```bash
# æ£€æŸ¥ç¯å¢ƒä¾èµ–
node --version && pnpm --version && java --version && docker --version
```

**é¢„æœŸè¾“å‡ºï¼š**
```
v16.15.0
8.15.9
openjdk 17.0.2 2022-01-18
OpenJDK Runtime Environment (build 17.0.2+8-86)
OpenJDK 64-Bit Server VM (build 17.0.2+8-86, mixed mode, sharing)
Docker version 24.0.6, build ed223bc
```

### æ­¥éª¤2: æ£€æŸ¥ç¯å¢ƒé…ç½®æ–‡ä»¶

ç¡®è®¤é¡¹ç›®æ ¹ç›®å½•ä¸‹å­˜åœ¨å¿…è¦çš„ç¯å¢ƒé…ç½®æ–‡ä»¶ï¼š

```bash
ls -la | grep -E "\.env"
```

**é¢„æœŸè¾“å‡ºï¼š**
```
-rw-r--r--@   1 karekin  staff     2518 Oct  4 23:20 .env
-rw-r--    1 karekin  staff      670 Oct  4 23:13 .env.devenv
```

### æ­¥éª¤3: å¯åŠ¨æ•°æ®ç¯å¢ƒ

å¯åŠ¨æ‰€æœ‰å¿…éœ€çš„æ•°æ®æœåŠ¡ï¼ˆMySQLã€Redisã€RabbitMQã€MinIOï¼‰ï¼š

```bash
make dataenv
```

**é¢„æœŸè¾“å‡ºï¼š**
```
mkdir -p ./.data/mysql \
        ./.data/minio/data \
        ./.data/minio/config \
        ./.data/redis \
        ./.data/rabbitmq \

docker compose --env-file .env -p apitable-devenv -f docker-compose.yaml -f docker-compose.dataenv.yaml up -d mysql minio redis rabbitmq init-db init-appdata   
[+] Running 6/6
 âœ” init-db Pulled                                                         39.0s 
 âœ” minio Pulled                                                           39.0s 
 âœ” redis Pulled                                                           39.0s 
 âœ” mysql Pulled                                                           39.0s 
 âœ” rabbitmq Pulled                                                        39.0s 
 âœ” init-appdata Pulled                                                    39.0s
[+] Building 0.0s (0/0)                                    docker:desktop-linux
[+] Running 6/6
 âœ” Container redis                           Started                      10.2s 
 âœ” Container mysql                           Healthy                       4.5s 
 âœ” Container minio                           Started                       0.8s 
 âœ” Container rabbitmq                        Start...                      6.5s 
 âœ” Container apitable-devenv-init-db-1       Exited                        0.1s 
 âœ” Container apitable-devenv-init-appdata-1  Started                       0.0s 
```

### æ­¥éª¤4: å®‰è£…é¡¹ç›®ä¾èµ–

å®‰è£…æ‰€æœ‰å‰ç«¯å’Œåç«¯ä¾èµ–ï¼š

```bash
pnpm install
```

**é¢„æœŸè¾“å‡ºï¼š**
```
Scope: all 8 workspace projects
Lockfile is up to date, resolution step is skipped
Packages: +3956
...
Done in 51.2s
```

### æ­¥éª¤5: æ„å»ºå‰ç«¯åŒ…

æ„å»ºæ ¸å¿ƒç»„ä»¶å’Œå›¾æ ‡åŒ…ï¼š

```bash
pnpm build:pre
```

**é¢„æœŸè¾“å‡ºï¼š**
```
> api-table-easy@1.0.0 build:pre /Volumes/karekinSSD1/project/ApiTableEasy
> nx run-many -t build -p  @apitable/core @apitable/icons --parallel=2 && pnpm -F @apitable/components run build                                                

 
    âœ”  nx run @apitable/icons:build (5s)
    âœ”  nx run @apitable/core:build (10s)

 â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”

 >  NX   Successfully ran target build for 2 projects (10s)
 

> @apitable/components@1.13.0 build /Volumes/karekinSSD1/project/ApiTableEasy/packages/components                                                               
> rimraf ./dist && tsc && tsc-alias
```

### æ­¥éª¤6: æ„å»ºå…¶ä»–åŒ…

æ„å»ºAPIå®¢æˆ·ç«¯å’ŒWidget SDKï¼š

```bash
pnpm build:dst
```

**é¢„æœŸè¾“å‡ºï¼š**
```
> api-table-easy@1.0.0 build:dst /Volumes/karekinSSD1/project/ApiTableEasy
> nx run-many -t build -p  @apitable/widget-sdk @apitable/api-client --parallel=2 && pnpm -F @apitable/core run build-cjs                                       

 
    âœ”  nx run @apitable/api-client:build (5s)
    âœ”  nx run @apitable/widget-sdk:build (6s)

 â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”

 >  NX   Successfully ran target build for 2 projects (6s)
 

> @apitable/core@1.13.0 build-cjs /Volumes/karekinSSD1/project/ApiTableEasy/packages/core                                                                       
> rimraf ./dist && tsc --module commonjs && tsc-alias
```

### æ­¥éª¤7: æ„å»ºJavaåç«¯

æ„å»ºSpring Bootåç«¯æœåŠ¡ï¼š

```bash
# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x backend-server/gradlew

# æ„å»ºåç«¯
cd backend-server && ./gradlew build -x test --stacktrace
```

**é¢„æœŸè¾“å‡ºï¼š**
```
Starting a Gradle Daemon, 1 incompatible Daemon could not be reused, use --status for details                                                                   
Configuration on demand is an incubating feature.
...
BUILD SUCCESSFUL in 29s
53 actionable tasks: 49 executed, 4 up-to-date
```

### æ­¥éª¤8: å¯åŠ¨æœåŠ¡

#### 8.1 å¯åŠ¨Backend Server (Javaåç«¯)

```bash
echo "1" | make run
```

**é¢„æœŸè¾“å‡ºï¼š**
```
Tomcat started on port 8081 (http) with context path '/api/v1'
gRPC Server started, listening on address: *, port: 8083
Started Application in 8.745 seconds (process running for 9.093)
```

#### 8.2 å¯åŠ¨Room Server (ååŒç¼–è¾‘æœåŠ¡)

```bash
echo "2" | make run
```

**é¢„æœŸè¾“å‡ºï¼š**
```
[ROOM_SERVER] Info      2025-10-04 23:28:10.746 [Bootstrap] Application[ROOM_SERVER]-Env[development]
[ROOM_SERVER] Info      2025-10-04 23:28:10.746 [Bootstrap] The service is running, please visit it: [ http://127.0.0.1:3333 ]
```

#### 8.3 å¯åŠ¨Web Server (å‰ç«¯ç•Œé¢)

```bash
echo "3" | make run
```

**é¢„æœŸè¾“å‡ºï¼š**
```
wait  - compiling /login (client and server)...
âœ” Client
  Compiled successfully in 477.12ms
âœ” Edge-server
âœ” Server
  Compiled successfully in 392.69ms
```

## æœåŠ¡æ¶æ„

### æ ¸å¿ƒæœåŠ¡

| æœåŠ¡ | ç«¯å£ | æè¿° | æŠ€æœ¯æ ˆ | çŠ¶æ€ |
|------|------|------|--------|------|
| backend-server | 8081 | åç«¯APIæœåŠ¡ | Java Spring Boot | âœ… è¿è¡Œä¸­ |
| room-server | 3333 | ååŒç¼–è¾‘æœåŠ¡ | Node.js + NestJS | âœ… è¿è¡Œä¸­ |
| web-server | 3000 | å‰ç«¯ç•Œé¢ | Next.js | âœ… è¿è¡Œä¸­ |
| databus-server | 8625 | æ•°æ®æ€»çº¿æœåŠ¡ | Dockerå®¹å™¨ | âœ… è¿è¡Œä¸­ |

### æ•°æ®æœåŠ¡

| æœåŠ¡ | ç«¯å£ | æè¿° | ç®¡ç†ç•Œé¢ | çŠ¶æ€ |
|------|------|------|----------|------|
| MySQL | 3306 | ä¸»æ•°æ®åº“ | - | âœ… è¿è¡Œä¸­ |
| Redis | 6379 | ç¼“å­˜æœåŠ¡ | - | âœ… è¿è¡Œä¸­ |
| RabbitMQ | 5672, 15672 | æ¶ˆæ¯é˜Ÿåˆ— | http://localhost:15672 | âœ… è¿è¡Œä¸­ |
| MinIO | 9000-9001 | å¯¹è±¡å­˜å‚¨ | http://localhost:9001 | âœ… è¿è¡Œä¸­ |

## è®¿é—®åœ°å€

- **å‰ç«¯ç•Œé¢**: http://localhost:3000
- **åç«¯API**: http://localhost:8081/api/v1
- **ååŒç¼–è¾‘æœåŠ¡**: http://localhost:3333
- **æ•°æ®æ€»çº¿æœåŠ¡**: http://localhost:8625
- **RabbitMQç®¡ç†**: http://localhost:15672
- **MinIOç®¡ç†**: http://localhost:9001

## æœåŠ¡çŠ¶æ€æ£€æŸ¥

### æ£€æŸ¥ç«¯å£ç›‘å¬

```bash
netstat -an | grep LISTEN | grep -E "(8081|3000|3333|8625)"
```

**é¢„æœŸè¾“å‡ºï¼š**
```
tcp46      0      0  *.3000                 *.*                    LISTEN     
tcp4       0      0  *.3333                 *.*                    LISTEN     
tcp46      0      0  *.8081                 *.*                    LISTEN     
tcp46      0      0  *.8625                 *.*                    LISTEN     
```

### æ£€æŸ¥Dockerå®¹å™¨

```bash
docker ps --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}"
```

**é¢„æœŸè¾“å‡ºï¼š**
```
NAMES                              STATUS                   PORTS
rabbitmq                           Up 8 minutes             4369/tcp, 0.0.0.0:5671-5672->5671-5672/tcp, 15671/tcp, 15691-15692/tcp, 25672/tcp, 0.0.0.0:15672->15672/tcp
redis                              Up 8 minutes             0.0.0.0:6379->6379/tcp
mysql                              Up 8 minutes (healthy)   0.0.0.0:3306->3306/tcp, 33060/tcp
minio                              Up 8 minutes (healthy)   0.0.0.0:9000-9001->9000-9001/tcp
apitable-devenv-databus-server-1   Up 22 minutes            0.0.0.0:8625->8625/tcp
```

### æ£€æŸ¥è¿›ç¨‹çŠ¶æ€

```bash
ps aux | grep -E "(java.*application.jar|node.*server.js|node.*nest)" | grep -v grep
```

**é¢„æœŸè¾“å‡ºï¼š**
```
karekin          38198  55.7  0.2 413274960  70480 s011  S+   11:27PM   1:39.34 node /Volumes/karekinSSD1/project/ApiTableEasy/packages/room-server/node_modules/.bin/../@nestjs/cli/bin/nest.js start --watch
karekin          37078   0.5  0.2 422370464  80624 s008  S+   11:27PM   0:42.23 /usr/bin/java -jar application/build/libs/application.jar
karekin          38689   0.3 19.5 474691504 6555728 s013  S+   11:27PM   3:34.38 node --max-old-space-size=10000 server.js
```

## å¸¸è§é—®é¢˜è§£å†³

### 1. Dockeré•œåƒæ‹‰å–å¤±è´¥

```bash
# é…ç½®å›½å†…é•œåƒæº
# ç¼–è¾‘ ~/.docker/daemon.json
{
  "registry-mirrors": [
    "https://docker.mirrors.ustc.edu.cn",
    "https://hub-mirror.c.163.com"
  ]
}
```

### 2. Node.jsç‰ˆæœ¬ä¸åŒ¹é…

```bash
# ä½¿ç”¨nvmå®‰è£…æŒ‡å®šç‰ˆæœ¬
nvm install 16.15.0
nvm use 16.15.0
```

### 3. ç«¯å£å†²çª

```bash
# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :8081
lsof -i :3000
lsof -i :3333
lsof -i :8625
```

### 4. gradlewæƒé™é—®é¢˜

```bash
# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x backend-server/gradlew
```

## åœæ­¢æœåŠ¡

### åœæ­¢æ‰€æœ‰Dockerå®¹å™¨

```bash
docker compose down
```

### åœæ­¢è¿›ç¨‹æœåŠ¡

```bash
# æŸ¥æ‰¾å¹¶ç»ˆæ­¢ç›¸å…³è¿›ç¨‹
ps aux | grep -E "(java|node|nest)" | grep -v grep
kill -9 <PID>
```

## å¼€å‘è¯´æ˜

### é¡¹ç›®ç»“æ„

1. **backend-server** - åç«¯æœåŠ¡æ¨¡å—
   - æä¾›æ‰€æœ‰æ•°æ®è¯·æ±‚æ¥å£
   - ä½¿ç”¨MySQLã€Redisã€RabbitMQä¸­é—´ä»¶
   - ç”¨æˆ·è´¦å·ä¿¡æ¯å­˜å‚¨åœ¨`apitable_user`è¡¨

2. **room-server** - ååŒç¼–è¾‘æ¨¡å—
   - å®ç°å®æ—¶åä½œåŠŸèƒ½
   - ä¾èµ–databus-server

3. **web-server** - å‰ç«¯æ¨¡å—
   - åŸºäºNext.jsæ„å»º
   - ä½¿ç”¨æ–‡ä»¶è·¯å¾„è·¯ç”±æ¨¡å¼
   - ä»…4ä¸ªé¡µé¢ä½¿ç”¨SSRï¼Œå…¶ä½™ä¸ºCSR

4. **databus-server** - æ•°æ®æ€»çº¿æœåŠ¡
   - æ”¯æŒååŒç¼–è¾‘åŠŸèƒ½
   - é€šè¿‡Dockerå®¹å™¨è¿è¡Œ

### æŠ€æœ¯ç‰¹ç‚¹

- **å‰ç«¯æ¸²æŸ“**: ä¸»è¦ä½¿ç”¨CSR(å®¢æˆ·ç«¯æ¸²æŸ“)ï¼Œå°‘é‡SSR(æœåŠ¡ç«¯æ¸²æŸ“)
- **çŠ¶æ€ç®¡ç†**: é€šè¿‡axioså‘é€ç½‘ç»œè¯·æ±‚è°ƒç”¨åç«¯æ¥å£
- **å®æ—¶åä½œ**: åŸºäºWebSocketå®ç°å¤šç”¨æˆ·åä½œ

## æ•…éšœæ’é™¤

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æŒ‰ä»¥ä¸‹é¡ºåºæ£€æŸ¥ï¼š

1. ç¡®è®¤æ‰€æœ‰ç¯å¢ƒä¾èµ–ç‰ˆæœ¬æ­£ç¡®
2. æ£€æŸ¥Dockerå®¹å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œ
3. éªŒè¯ç«¯å£æ˜¯å¦è¢«æ­£ç¡®ç›‘å¬
4. æŸ¥çœ‹æœåŠ¡æ—¥å¿—è¾“å‡º
5. ç¡®è®¤ç¯å¢ƒé…ç½®æ–‡ä»¶å­˜åœ¨ä¸”æ­£ç¡®

## è´¡çŒ®æŒ‡å—

1. Forké¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. æ¨é€åˆ°åˆ†æ”¯
5. åˆ›å»ºPull Request

---

**å¯åŠ¨å®Œæˆï¼** ğŸ‰

æ‰€æœ‰æœåŠ¡å·²æˆåŠŸå¯åŠ¨ï¼Œæ‚¨ç°åœ¨å¯ä»¥è®¿é—® http://localhost:3000 å¼€å§‹ä½¿ç”¨APITableäº†ï¼

